<style>
 :root {
  --kw-bg-overlay: rgba(0, 0, 0, 0.55);
  --kw-text: #ffffff;
  --kw-accent: #00e676;        /* BRAND: Change this color */
  --kw-accent-text: #0b0f14;   /* BRAND: Change this color */
  --kw-font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, sans-serif;
}

  #echo-root {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    font-family: var(--kw-font);
    color: var(--kw-text);
    z-index: 1000;
    pointer-events: none;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  #echo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--kw-bg-overlay);
    z-index: 1;
    pointer-events: none;
  }

  #echo-content {
    position: relative;
    z-index: 2;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 22px;
    width: 100%;
    max-width: 720px;
    margin: 0 auto;
    text-align: center;
    pointer-events: auto;
  }

  #hl {
    margin: 0 0 14px;
    font-size: 38px;
    line-height: 1.08;
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  #sh {
    margin: 0 0 22px;
    font-size: 18px;
    line-height: 1.45;
    opacity: 0.95;
  }

  #cta {
    display: inline-block;
    padding: 16px 26px;
    background: var(--kw-accent);
    color: var(--kw-accent-text);
    text-decoration: none;
    font-size: 18px;
    border-radius: 12px;
    font-weight: 900;
    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
  }

  #echo-footer {
    position: relative;
    z-index: 2;
    width: 100%;
    padding: 14px 20px;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: auto;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.8);
  }

  #footer-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  #footer-copyright {
    margin: 0;
  }

  #footer-links {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  #footer-links a {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: color 0.2s;
  }

  #footer-links a:hover {
    color: #ffffff;
  }

  @media (max-width: 420px) {
    #hl {
      font-size: 30px;
    }
    #sh {
      font-size: 16px;
    }
    #cta {
      width: 100%;
      max-width: 320px;
    }
    #footer-content {
      flex-direction: column;
      text-align: center;
      gap: 8px;
    }
    #echo-footer {
      font-size: 11px;
      padding: 12px 16px;
    }
  }
</style>

<div id="echo-root">
  <div id="echo-overlay"></div>

  <div id="echo-content">
   <h1 id="hl" data-default="[BRAND HEADLINE]">[BRAND HEADLINE]</h1>
<p id="sh" data-default="[BRAND SUBHEADLINE]">[BRAND SUBHEADLINE]</p>
<a id="cta" data-default="[BRAND CTA]"
  href="[BRAND DEFAULT LINK]">
  [BRAND CTA]
</a>
<div id="bg" data-default="[BRAND_IMAGE.jpg]" style="display:none"></div>
  </div>

  <footer id="echo-footer">
    <div id="footer-content">
     <p id="footer-copyright">Â© 2025 [BRAND NAME]. All rights reserved.</p>
<div id="footer-links">
  <a href="[BRAND PRIVACY URL]" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
  <a href="[BRAND TERMS URL]" target="_blank" rel="noopener noreferrer">Terms of Service</a>
  <a href="[BRAND COOKIES URL]" target="_blank" rel="noopener noreferrer">Cookie Policy</a>
</div>
    </div>
  </footer>
</div>

<script>
  (function () {
  function parseParams(str) {
    str = (str || "").replace(/^[?#]/, "");
    var params = {};
    if (!str) return params;

    str.split("&").forEach(function (pair) {
      var parts = pair.split("=");
      var key = decodeURIComponent(parts[0] || "").trim();
      var val = decodeURIComponent((parts[1] || "").split("+").join(" ")).trim();
      if (key) params[key] = val;
    });

    return params;
  }

  var params = Object.assign({}, parseParams(window.location.search), parseParams(window.location.hash));
  console.log("DYNAMIC PARAMS:", params);

  var hlEl = document.getElementById("hl");
  var shEl = document.getElementById("sh");
  var ctaEl = document.getElementById("cta");

  if (params.hl && hlEl) hlEl.textContent = params.hl;
  if (params.sh && shEl) shEl.textContent = params.sh;
  if (params.cta && ctaEl) ctaEl.textContent = params.cta;

  // BUTTON COLOR (simple)
  if (params.btn_color) {
    ctaEl.style.background = '#' + params.btn_color;
  }
  if (params.btn_text) {
    ctaEl.style.color = '#' + params.btn_text;
  }
  
  // BUTTON SIZE (simple)
  if (params.btn_size === 'large') {
    ctaEl.style.padding = '20px 36px';
    ctaEl.style.fontSize = '20px';
  }

  // SMART BUTTON LINK BUILDER
  // Automatically merges CTA and tracking params to destination URL
  if (ctaEl) {
    var destinationURL = params.link || ctaEl.getAttribute("data-default-href") || ctaEl.href;
    
    // Auto-add https:// if missing
    if (params.link && !/^https?:\/\//i.test(params.link)) {
      destinationURL = "https://" + params.link;
    }
    
    // Parse destination URL to check if it already has params
    var urlParts = destinationURL.split('?');
    var baseURL = urlParts[0];
    var existingParams = urlParts[1] ? urlParts[1] : '';
    
    // Build new params object (excluding content params)
    var contentParams = ["hl", "sh", "img", "link", "btn_color", "btn_text", "btn_size"];
    var trackingParams = [];
    
    // AUTO-ADD CTA to destination (this is the key feature!)
    if (params.cta) {
      trackingParams.push("cta=" + encodeURIComponent(params.cta));
      console.log("AUTO-MATCH: CTA '" + params.cta + "' will be passed to destination");
    }
    
    // Add all other tracking params
    for (var key in params) {
      if (params.hasOwnProperty(key) && contentParams.indexOf(key) === -1 && key !== 'cta') {
        trackingParams.push(encodeURIComponent(key) + "=" + encodeURIComponent(params[key]));
      }
    }
    
    // Merge existing params with new params
    var allParams = existingParams ? [existingParams] : [];
    if (trackingParams.length > 0) {
      allParams = allParams.concat(trackingParams);
    }
    
    // Build final URL
    var finalURL = baseURL + (allParams.length > 0 ? '?' + allParams.join('&') : '');
    ctaEl.href = finalURL;
    
    console.log("BUTTON LINK:", finalURL);
  }

  var root = document.getElementById("echo-root");
  if (!root) { console.log("BG: #echo-root not found."); return; }

  var bgEl = document.getElementById("bg");
  var defaultBg = bgEl ? (bgEl.getAttribute("data-default") || "").trim() : "";
  var chosen = (params.img || defaultBg || "").trim();

  if (!chosen) {
    console.log("BG: No img param and no data-default set. Background unchanged.");
    return;
  }

  if (/^https?:\/\//i.test(chosen)) {
    root.style.backgroundImage = 'url("' + chosen + '")';
    console.log("BG SET (full url):", chosen);
    return;
  }

  chosen = decodeURIComponent(chosen).replace(/^\/+/, "");
  var origin = window.location.origin.replace(/\/+$/, "");
  var candidates = [
    origin + "/public/" + chosen,
    origin + "/" + chosen
  ];

  function tryLoad(i) {
    if (i >= candidates.length) {
      console.log("BG FAILED: none loaded:", candidates);
      console.log("BG NOTE: This usually means the file is NOT deployed on this subdomain.");
      return;
    }

    var url = candidates[i];
    var img = new Image();

    img.onload = function () {
      root.style.backgroundImage = 'url("' + url + '")';
      root.style.backgroundSize = "cover";
      root.style.backgroundPosition = "center";
      root.style.backgroundRepeat = "no-repeat";
      console.log("BG LOADED OK:", url);
    };

    img.onerror = function () {
      console.log("BG 404/FAIL:", url);
      tryLoad(i + 1);
    };

    img.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "v=" + Date.now();
  }

  console.log("BG PROBING:", candidates);
  tryLoad(0);
})();
</script>
